# dmz防火墙配置与邮件服务的搭建

## 第一部分

### 一、配置网络

建立四台主机，一个作为内网客户端，一个作为防火墙，一个作为dmz服务器，一个连通外网。

![屏幕截图 2024-09-26 154458](屏幕截图 2024-09-26 154458.png)

内网客户端(inner)：一块网卡（vmnet1）ip：192.168.2.2

![屏幕截图 2024-09-26 160008](./%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-09-26%20160008.png)

防火墙(firewalld)：三块网卡（vmnet1 ip：192.168.2.1）(vmnet2 ip: 172.16.2.1) (vmnet3 ip: 10.10.2.1)

![屏幕截图 2024-09-26 160107](./%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-09-26%20160107.png)

dmz服务器(dmz)：一块网卡（vmnet2 ip：172.16.2.2）

![屏幕截图 2024-09-26 160234](./%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-09-26%20160234.png)

外网主机(outer):  两块网卡（vmnet3 ip：10.10.2.2）（vmnet0 桥接物理网卡）

![屏幕截图 2024-09-26 160414](./%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-09-26%20160414.png)

### 二、在内网、dmz和外网主机配置路由，使得能够互相访问

inner脚本

```
@echo off   
route add 172.16.2.0 mask 255.255.255.0 192.168.2.1 
route add 10.10.2.0 mask 255.255.255.0 192.168.2.1
```

dmz脚本

```
@echo off   
route add 192.16.2.0 mask 255.255.255.0 172.16.2.1 
route add 10.10.2.0 mask 255.255.255.0 172.16.2.1
```

outer脚本

```
@echo off   
route add 172.16.2.0 mask 255.255.255.0 10.10.2.1 
route add 192.168.2.0 mask 255.255.255.0 10.10.2.1
```

在防火墙上配置路由转发

```
echo "net.ipv4.ip_forward = 1"  >> /etc/sysctl.conf
```

### 三、测试网络连通性

防火墙与其它主机连通性

![屏幕截图 2024-09-26 161243](./%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-09-26%20161243.png)

inner与其它主机连通性

​                   ![屏幕截图 2024-09-26 161600](./%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-09-26%20161600.png)                    

dmz与其它主机连通性

![屏幕截图 2024-09-26 161852](./%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-09-26%20161852.png)

outer与其它主机连通性

![屏幕截图 2024-09-26 162212](./%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-09-26%20162212.png)

## 第二部分

### 一、服务配置

在防火墙配置dns，安装named  服务

```
yum install -y bind bind-chroot bind-utils
yum install -y bind*
```

在/etc目录下编辑named.conf文件

![屏幕截图 2024-09-26 165913](./%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-09-26%20165913.png)

在/etc/下编辑named.rfc1912.zones文件

![屏幕截图 2024-09-26 170709](./%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-09-26%20170709.png)

在/var/named目录下复制named.localhost

```
cp -a named.localhost b.cn.zone
cp -a named.localhost dev.a.com.zone
```

对b.cn.zone进行设置

![屏幕截图 2024-09-26 170953](./%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-09-26%20170953.png)

对dev.a.com.zone进行设置

![屏幕截图 2024-09-26 171144](./%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-09-26%20171144.png)

在/var/named目录下复制named.loopback

```
cp -a named.loopback 3.16.172.zone
cp -a named.loopback 6.16.172.zone
```

对3.16.172.zone进行设置

![屏幕截图 2024-09-26 171253](./%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-09-26%20171253.png)

对6.16.172.zone进行设置

![屏幕截图 2024-09-26 171359](./%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-09-26%20171359.png)

对named.ca修改

![屏幕截图 2024-09-26 201042](./%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-09-26%20201042.png)

然后重新启动named服务，发现没有问题

![屏幕截图 2024-09-26 171718](./%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-09-26%20171718.png)

在dmz配置dns，安装dns服务器

在正向查找区域新建a.com主要区域，并建立主机和邮件交换机

![屏幕截图 2024-09-26 201207](./%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-09-26%20201207.png)

在正向查找区域新建b.cn辅助区域，ip地址填防火墙b.cn.zone的ip 172.16.2.1

![屏幕截图 2024-09-26 172309](./%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-09-26%20172309.png)

在outer配置dns，安装dns服务器

在正向查找区域新建根域，再在根域下新建域，然后委派

![屏幕截图 2024-09-26 172814](./%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-09-26%20172814.png)

在正向查找区域新建c.edu主要区域，然后新建主机和邮件交换机器

![屏幕截图 2024-09-26 173345](./%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-09-26%20173345.png)

| 成员姓名 | 具体工作                       | 评分 |
| :------- | :----------------------------- | :--- |
| 苏嘉诺   | 查阅资料，编辑代码             | 97   |
| 刘少杰   | 建立虚拟机，配置网络，配置服务 | 140  |
| 吕仕通   | 查资料                         | 97   |
| 倪涛     | 整理文档                       | 90   |
| 王晓佳   | 整理文档                       | 90   |
| 程宇     | 美工                           | 95   |
| 聂晓伟   | 调试                           | 90   |
| 王小鹏   | 调试                           | 100  |

